!function(d){"use strict";function c(i,n){return"function"==typeof i&&(n=i,i={}),{options:i="object"!=typeof i?{}:i,callback:n="function"!=typeof n?function(){}:n}}var u=[];d.fn.dimBackground=function(t,i){var n=c(t,i);t=n.options,i=n.callback,t=d.extend({},d.fn.dimBackground.defaults,t);var a=d('<div class="dimbackground-curtain"></div>');return a.css({position:"fixed",left:0,top:0,width:"100%",height:"100%",background:"black",opacity:0,zIndex:t.curtainZIndex}),d("body").append(a),this.each(function(){var i=d(this),n=d.meta?d.extend({},t,i.data()):t;this._$curtain=a,this._originalPosition=i.css("position").toLowerCase(),"absolute"!=this._originalPosition&&"fixed"!=this._originalPosition&&i.css("position","relative"),this._originalZIndex=i.css("z-index"),("auto"==this._originalZIndex||this._originalZIndex<=n.curtainZIndex)&&i.css("z-index",n.curtainZIndex+1)}),a.stop().animate({opacity:t.darkness},t.fadeInDuration,i),u.push({$curtain:a,$nodes:this}),this},d.fn.undim=function(n,o){var i=c(n,o);n=i.options,o=i.callback,n=d.extend({},d.fn.dimBackground.defaults,n);var s,e=[];if(this.each(function(){var i=d(this);d.meta&&d.extend({},n,i.data()),this._$curtain&&(s=s||this._$curtain,void 0!==this._originalPosition&&e.push([this,this._originalPosition,this._originalZIndex]),this._$curtain=void 0,this._originalPosition=void 0,this._originalZIndex=void 0)}),s){s.animate({opacity:0},n.fadeOutDuration,function(){for(var i=0;i<e.length;i++){var n=e[i][0],t=e[i][1],a=e[i][2];d(n).css({position:t,zIndex:a})}s.remove(),o()});for(var t,a=0;a<u.length;a++)if(u[a].$curtain==s){t=a;break}t&&(u=u.slice(0,a).concat(u.slice(a+1)))}return this},d.undim=function(i,n){function t(){++s==e&&n()}var a=c(i,n);i=a.options,n=a.callback,i=d.extend({},d.fn.dimBackground.defaults,i);for(var o=u.slice(),s=0,e=o.length,r=0;r<u.length;r++)o[r].$nodes.undim(i,t);0===e&&n()},d.fn.dimBackground.defaults={darkness:.75,fadeInDuration:300,fadeOutDuration:300,curtainZIndex:999}}(jQuery);